# TÓM TẮT DỰ ÁN SOCIAL DOWNLOAD MANAGER

## TỔNG QUAN
Social Download Manager (ban đầu là TikTok Downloader) là ứng dụng desktop được phát triển bằng Python và PyQt6, cho phép người dùng tải video từ TikTok (và dự kiến sẽ mở rộng sang các nền tảng mạng xã hội khác) mà không có watermark. Ứng dụng có giao diện thân thiện, hỗ trợ đa ngôn ngữ (hiện tại là tiếng Anh và tiếng Việt), và nhiều tính năng hữu ích cho người dùng.

## TÍNH NĂNG CHÍNH
- Tải video TikTok không watermark
- Hỗ trợ tải nhiều video cùng lúc (batch download)
- Cho phép nhập nhiều URL một lúc
- Tính năng "Select All" và "Unselect All" để dễ dàng chọn/bỏ chọn video
- Lựa chọn chất lượng video (360p, 480p, 720p, 1080p)
- Quản lý lịch sử tải xuống với chức năng tìm kiếm và sắp xếp
- Sao chép thông tin video (tiêu đề, tác giả, hashtags)
- Xem preview thông tin video trước khi tải
- Hiển thị thumbnail của video
- Hỗ trợ đa ngôn ngữ (Tiếng Anh, Tiếng Việt)
- Cơ sở dữ liệu SQLite để lưu thông tin video đã tải
- Tính năng đổi tên video trước và trong khi tải xuống
- Xử lý thông minh với video không có tiêu đề
- Phát video trực tiếp từ tab "Downloaded Videos"
- Chuyển đổi sang MP3 với xử lý tên file thông minh

## CẤU TRÚC DỰ ÁN
- `main.py`: Điểm khởi đầu của ứng dụng
- `ui/`: Thư mục chứa các file liên quan đến giao diện
  - `main_window.py`: Cửa sổ chính của ứng dụng
  - `video_info_tab.py`: Tab hiển thị thông tin video và tải xuống
  - `downloaded_videos_tab.py`: Tab quản lý video đã tải xuống
  - `donate_tab.py`: Tab cho phần quyên góp
- `utils/`: Thư mục chứa các tiện ích
  - `downloader.py`: Xử lý tải video
  - `db_manager.py`: Quản lý cơ sở dữ liệu SQLite
  - `download_thread.py`: Xử lý tải xuống bất đồng bộ
- `localization/`: Thư mục chứa các file ngôn ngữ
  - `english.py`: Chuỗi tiếng Anh
  - `vietnamese.py`: Chuỗi tiếng Việt
  - `language_manager.py`: Quản lý ngôn ngữ
- `assets/`: Thư mục chứa tài nguyên (logo, hình ảnh)
- `config.json`: File cấu hình ứng dụng

## CẬP NHẬT GẦN ĐÂY
1. **Đã thêm tính năng "Rename Video"**:
   - Cho phép người dùng đổi tên video trước khi tải xuống thông qua menu chuột phải
   - Tên mới sẽ được hiển thị trong tab "Downloaded Videos" và làm tên file khi lưu
   - Áp dụng các quy tắc làm sạch tên tệp để đảm bảo tính hợp lệ

2. **Xử lý cải tiến cho video không có tiêu đề**:
   - Bắt buộc người dùng phải đặt tên file trước khi tải xuống nếu video không có tiêu đề
   - Tự động đề xuất tên mặc định dựa trên timestamp: Video_YYYYMMdd_HHmmss
   - Tên đã đặt sẽ được lưu vào cơ sở dữ liệu và hiển thị chính xác trong tab Downloaded Videos

3. **Cải tiến thuật toán tìm kiếm và phát video**:
   - Nâng cao khả năng tìm kiếm tập tin dựa trên tiêu đề, bao gồm xử lý khi tiêu đề có ký tự đặc biệt
   - Thêm nhiều biến thể tìm kiếm như từ đầu tiên, 3 từ đầu, 5 từ đầu để tăng khả năng tìm thấy file
   - Hỗ trợ đặc biệt xử lý các ký tự đặc biệt như dấu ngoặc kép, ba chấm, v.v.
   - Giảm ngưỡng tương đồng xuống 30% để tìm được nhiều file hơn

4. **Giao diện "File Already Exists" cải tiến**:
   - Thêm tùy chọn "Apply to all" cho việc ghi đè file trong trường hợp tải nhiều video
   - Chỉ hiển thị "Apply to all" khi có từ 2 file trở lên cần xử lý
   - Cải thiện vị trí của checkbox "Apply to all" sang cùng hàng với các nút Yes/No/Cancel
   - Thêm spacing và style để giao diện trông chuyên nghiệp và cân đối hơn
   - Sửa lỗi không hiển thị "Apply to all" ở thông báo file đã tồn tại đầu tiên

5. **Cải tiến lưu và hiển thị thông tin video**:
   - Tên tùy chỉnh sẽ được lưu vào cả video_info và VideoInfo object
   - Hiển thị đúng tên đã đặt trong tab Downloaded Videos, kể cả khi không có tiêu đề ban đầu
   - Xác định tên file thông minh dựa trên các thuộc tính có sẵn

6. **Cải tiến quá trình chuyển đổi MP3**:
   - Đơn giản hóa quy trình chuyển đổi MP3 bằng cách lưu trực tiếp vào đường dẫn đích
   - Loại bỏ bước tạo tệp tạm thời và đổi tên sau đó, giảm thiểu lỗi đường dẫn
   - Thêm kiểm tra file đầu ra đã được tạo thành công
   - Bổ sung nhật ký chi tiết để dễ dàng gỡ lỗi
   - Xử lý đúng đắn tên tệp đặc biệt và ký tự không hợp lệ trong tên file đầu ra

7. **Đã thêm tính năng xóa file vật lý khi xóa record video**:
   - Thêm checkbox "Delete file from disk" trong dialog xác nhận xóa
   - Kiểm tra sự tồn tại của file trước khi cho phép xóa
   - Hỗ trợ xóa nhiều file cùng lúc với tùy chọn "Apply to all"
   - Hiển thị thông báo cụ thể về số lượng file đã xóa
   - Cải thiện giao diện người dùng với vị trí checkbox phù hợp và dễ sử dụng
   - Tự động xóa file thumbnail khi người dùng chọn xóa file video
   - Kiểm tra sự tồn tại của thumbnail trước khi xóa để tránh lỗi
   - Cải thiện kích thước dialog xóa video trong tab Downloaded Videos để phù hợp với kiểu dialog khác

8. **Đã sửa các lỗi logic**:
   - Sửa lỗi hiển thị "Apply to all" khi chỉ có 1 file cần xử lý
   - Cải thiện việc tải xuống video không có tiêu đề
   - Sửa lỗi khi phát video có ký tự đặc biệt trong tên file như dấu ngoặc kép
   - Xử lý trường hợp video không có tiêu đề, tìm kiếm trong thư mục theo định dạng
   - Sửa lỗi nút Select All/Unselect All không cập nhật đúng khi chuyển tab từ Info sang Downloaded Videos

9. **Đã tối ưu giao diện tab "Downloaded Videos"**:
   - Điều chỉnh độ rộng cột, ưu tiên hiển thị cột Title (tăng từ 150px lên 250px)
   - Cố định kích thước các cột ngoại trừ Title để ngăn tự động co giãn
   - Cột Title được thiết lập ở chế độ Stretch để mở rộng khi có thêm không gian
   - Đã vô hiệu hóa sắp xếp cho cột Select

10. **Đã cải thiện dialog copy**:
   - Chỉ hiển thị nội dung full title đã loại bỏ hashtags để dễ dàng copy
   - Thêm định dạng cho các hashtags khi hiển thị riêng

11. **Đã sửa lỗi trong hàm `delete_selected_videos` và `on_download_finished`**

12. **Đã cải thiện cách hiển thị tooltip khi hover chuột vào các cột Title, Creator và Hashtags**

13. **Đã cải thiện xử lý lỗi khi gặp video chỉ chứa hình ảnh và âm thanh (không có video)**

14. **Đã sửa lỗi tự động tải xuống video MP3 không có tiêu đề mà không hỏi người dùng**

15. **Đã sửa lỗi hiển thị không đầy đủ tiêu đề khi double-click để copy ở tab Video Info**

16. **Đã loại bỏ các hashtag trong tiêu đề khi hiển thị trong dialog copy**

17. **Đã thêm tính năng xóa file vật lý khi xóa video từ danh sách**

## CÔNG NGHỆ SỬ DỤNG
- Python 3.8+
- PyQt6 cho giao diện người dùng
- SQLite cho cơ sở dữ liệu
- yt-dlp cho engine tải xuống
- Requests và BeautifulSoup4 cho việc tải và phân tích dữ liệu
- Git cho quản lý mã nguồn
- FFmpeg để chuyển đổi video sang MP3

## HƯỚNG PHÁT TRIỂN
- Mở rộng hỗ trợ tải xuống từ các nền tảng khác như YouTube, Instagram, Facebook
- Cải thiện hiệu suất tải xuống
- Thêm tính năng batch renaming cho nhiều video cùng lúc
- Cải thiện khả năng tổ chức dữ liệu để có thể đáp ứng được nhu cầu của user khi quản lý số lượng lớn các file đã tải xuống
- Hỗ trợ thêm các ngôn ngữ khác
- Tạo queue manager để quản lý hàng đợi tải xuống phức tạp hơn

## LƯU Ý KỸ THUẬT
- Ứng dụng sử dụng kiến trúc MVC (Model-View-Controller)
- Tải xuống được xử lý bất đồng bộ thông qua QThread
- Dữ liệu được lưu trữ trong cơ sở dữ liệu SQLite
- Giao diện được thiết kế để dễ sử dụng và đáp ứng
- Hỗ trợ đa ngôn ngữ thông qua cơ chế chuyển đổi chuỗi động
- Sử dụng custom context menu để cung cấp thêm tính năng như rename, play, open folder

## NHỮNG VẤN ĐỀ ĐÃ GIẢI QUYẾT
1. Đã xử lý lỗi khi hiển thị tiêu đề video và tác giả
2. Đã khắc phục sự cố khi xóa video đã chọn khỏi cơ sở dữ liệu
3. Đã sửa lỗi hiển thị trạng thái tải xuống không đúng
4. Đã cải thiện cách hiển thị trên tab "Downloaded Videos"
5. Đã xử lý lỗi khi tải nội dung không được hỗ trợ (như video chỉ chứa hình ảnh)
6. Đã khắc phục vấn đề về hiển thị hashtags trong tiêu đề khi copy
7. Đã sửa lỗi không thể phát video có dấu ngoặc kép trong tên
8. Đã cải thiện xử lý video không có tiêu đề, bắt buộc người dùng đặt tên
9. Đã sửa lỗi hiển thị "Apply to all" khi chỉ có 1 file cần xử lý
10. Đã sửa lỗi title không hiển thị đúng trong tab Downloaded Videos với video đã rename
11. Đã sửa lỗi chuyển đổi MP3 cho video không có tiêu đề
12. Đã cải thiện thuật toán đặt tên file khi chuyển đổi định dạng
13. Đã sửa lỗi tự động tải xuống video MP3 không có tiêu đề mà không hỏi người dùng
14. Đã sửa lỗi hiển thị không đầy đủ tiêu đề khi double-click để copy ở tab Video Info
15. Đã loại bỏ các hashtag trong tiêu đề khi hiển thị trong dialog copy
16. Đã thêm tính năng xóa file vật lý khi xóa video từ danh sách
17. Đã cải thiện tính năng xóa file vật lý bằng cách tự động xóa cả file thumbnail tương ứng

## CHI TIẾT TÍNH NĂNG "RENAME VIDEO"
- Hiển thị trong context menu (menu chuột phải) của tab Video Info
- Lưu tên gốc vào thuộc tính original_title của đối tượng video_info
- Cập nhật UI (bảng) với tên mới ngay lập tức
- Làm sạch tên file trước khi lưu, loại bỏ các ký tự không hợp lệ như: \/*?:"<>|
- Hiển thị thông báo thành công trong status bar
- Tên mới sẽ được sử dụng khi tải xuống và hiển thị trong tab Downloaded Videos

## CHI TIẾT XỬ LÝ VIDEO KHÔNG CÓ TIÊU ĐỀ
- Kiểm tra tiêu đề rỗng trước khi tải xuống
- Hiển thị hộp thoại yêu cầu nhập tên với tiêu đề và nội dung tùy chỉnh 
- Tạo tên mặc định theo định dạng "Video_YYYYMMdd_HHmmss"
- Nếu người dùng không nhập tên hoặc hủy dialog, video sẽ bị bỏ qua
- Lưu tên mới vào custom_title và cập nhật để hiển thị trong tab Downloaded Videos

## CHI TIẾT CẢI TIẾN THUẬT TOÁN TÌM KIẾM FILE
- Tìm kiếm file dựa trên nhiều biến thể của tiêu đề (5 từ đầu, 3 từ đầu, 1 từ đầu)
- Xử lý đặc biệt với các ký tự như ", ', đấu ba chấm (...)
- Tính điểm tương đồng dựa trên nhiều tiêu chí khác nhau
- Hỗ trợ tìm kiếm từng từ chung giữa tiêu đề và tên file
- Đối với video không có tiêu đề, ưu tiên tìm file có tên đặc biệt như "#.mp4" hoặc ".mp4"
- Giảm ngưỡng tương đồng xuống còn 30% để tăng tỷ lệ tìm thấy file 

## CHI TIẾT CẢI TIẾN QUÁ TRÌNH CHUYỂN ĐỔI MP3
- Đơn giản hóa quy trình chuyển đổi bằng cách sử dụng FFmpeg để xuất trực tiếp vào đường dẫn đích
- Loại bỏ quá trình tạo tệp tạm thời và đổi tên sau đó, giảm thiểu lỗi đường dẫn
- Thêm kiểm tra file đầu ra đã được tạo thành công
- Bổ sung nhật ký chi tiết để dễ dàng gỡ lỗi
- Xử lý đúng đắn tên tệp đặc biệt và ký tự không hợp lệ trong tên file đầu ra 

## CHI TIẾT TÍNH NĂNG XÓA FILE TỪ Ổ ĐĨA
- Thêm checkbox "Delete file from disk" trong dialog xóa video đơn lẻ
- Thêm checkbox "Delete files from disk" trong dialog xóa nhiều video
- Chỉ kích hoạt checkbox khi file thực sự tồn tại
- Thêm tùy chọn "Apply to all" cho xóa nhiều file (chỉ hiện khi có từ 2 file trở lên)
- Hiển thị hộp thoại xác nhận cho từng file khi không chọn "Apply to all"
- Cập nhật thông báo trạng thái cho biết số lượng file đã xóa
- Kiểm tra quyền truy cập và xử lý lỗi khi không thể xóa file
- Vị trí checkbox trực quan (bên trái, cùng hàng với các nút)
- Tự động xóa file thumbnail khi người dùng chọn xóa file video
- Kiểm tra tồn tại của thumbnail trước khi xóa 

## 2025-03-25: Cải tiến UI dialog xác nhận
1. **Đã sửa lỗi hiển thị dialog xác nhận xóa video**:
   - Khắc phục lỗi hiển thị mã translation key trực tiếp trong dialog (DIALOG_CONFIRM_DELETE_SELECTED_VIDEOS)
   - Thêm phương thức tr() vào lớp LanguageManager để hỗ trợ dịch key một cách linh hoạt hơn
   - Cải thiện hàm tr_() trong DownloadedVideosTab để xử lý trường hợp không có language manager
   - Thêm chuỗi DIALOG_INFO vào file ngôn ngữ đã bị thiếu

2. **Cải thiện giao diện dialog xác nhận xóa**:
   - Tăng kích thước dialog rộng hơn (500px) và cao hơn (200px) để hiển thị rõ ràng hơn
   - Hiển thị danh sách các video bị xóa (tối đa 5 video) khi xóa nhiều video cùng lúc
   - Loại bỏ các emoji không cần thiết và thông tin file chi tiết, làm giao diện đơn giản và chuyên nghiệp hơn

3. **Cải thiện giao diện dialog File Already Exists**:
   - Áp dụng thiết kế và style giống như dialog xác nhận xóa
   - Hiển thị danh sách các file bị ghi đè (tối đa 5 file) khi có nhiều file trùng tên
   - Thêm thông tin "... và X file khác" khi có nhiều hơn 5 file bị ghi đè
   - Áp dụng stylesheet đẹp hơn với nút xanh, màu nền tối và font dễ đọc
   - Loại bỏ style in đậm cho checkbox "Apply to all" để thống nhất giao diện
   - Loại bỏ nút Cancel, chỉ giữ lại nút Yes và No để giao diện đơn giản và tập trung hơn
   - Người dùng vẫn có thể đóng dialog bằng nút X ở góc trên bên phải nếu muốn hủy thao tác

4. **Nâng cấp các thành phần UI**:
   - Tất cả các dialog xác nhận giờ đây có layout nhất quán
   - Các nút Yes/No được thiết kế với hover effect và màu sắc rõ ràng hơn
   - Khoảng cách giữa các phần tử được điều chỉnh để dễ nhìn hơn

## 2024-03-26: Khắc phục lỗi UI và logic trong dialog và nút Select All
1. **Khắc phục lỗi hiển thị tên dialog "DIALOG_CONFIRM_DELETE_SELECTED_VIDEOS"**:
   - Sử dụng trực tiếp đối tượng LanguageManager để lấy chuỗi đã dịch thay vì qua phương thức tr_()
   - Đảm bảo chuỗi luôn được dịch đúng, ngay cả khi không có language manager
   - Vẫn giữ lại phần hiển thị danh sách video sẽ bị xóa trong dialog xác nhận xóa

2. **Cải thiện hiển thị danh sách file trong dialog "File Already Exists"**:
   - Sửa lại phương thức download_videos() để thu thập và hiển thị đúng danh sách các file bị ghi đè
   - Giới hạn hiển thị tối đa 5 file và hiển thị "... và X file khác" khi cần
   - Đảm bảo giao diện nhất quán với dialog xác nhận xóa

3. **Sửa lỗi logic nút "Select All/Unselect All"**:
   - Khi vừa chuyển sang tab Downloaded Videos, tất cả checkbox đều chưa được check nhưng nút hiển thị "Unselect All"
   - Thêm lệnh gọi update_select_toggle_button() vào cuối phương thức display_videos()
   - Đảm bảo nút hiển thị đúng trạng thái "Select All" khi không có checkbox nào được chọn
   - Đặt mặc định trạng thái checkbox là không chọn khi hiển thị danh sách video

4. **Cải thiện trải nghiệm người dùng**:
   - Đảm bảo tất cả dialog hiển thị đúng ngôn ngữ và văn bản đã được dịch
   - Cải thiện tính nhất quán giữa các dialog trong ứng dụng
   - Đảm bảo trạng thái UI luôn phản ánh đúng trạng thái hiện tại của dữ liệu

## 2024-03-26: Cải thiện thông báo File Already Exists và đồng nhất UI giữa các tab
1. **Cải thiện nội dung thông báo trong dialog "File Already Exists"**:
   - Sửa đổi chuỗi thông báo trong localization/english.py và localization/vietnamese.py
   - Thay thế văn bản cũ "File '{}' đã tồn tại trong thư mục lưu.\nBạn có muốn ghi đè lên không?" 
     bằng thông báo rõ ràng hơn "Những file sau đã tồn tại trong thư mục đầu ra. Bạn có muốn ghi đè lên không?"
   - Loại bỏ tham số định dạng {} không cần thiết, thay vào đó hiển thị trực tiếp danh sách file

2. **Sửa đổi cấu trúc hiển thị dialog**:
   - Đặt danh sách file đã tồn tại sau thông báo chính, phân tách bằng dòng trống
   - Hiển thị danh sách dưới dạng liệt kê với bullets (•) đầu dòng
   - Hiển thị tối đa 5 file và thông báo "... và X file khác" nếu có nhiều hơn

3. **Cải thiện luồng xử lý trong phương thức download_videos()**:
   - Thu thập danh sách file đã tồn tại trước
   - Sau đó mới tạo nội dung thông báo dựa trên danh sách
   - Đơn giản hóa code và tăng hiệu suất bằng cách loại bỏ các bước kiểm tra không cần thiết

4. **Đồng nhất hiệu ứng UI giữa các tab**:
   - Cập nhật stylesheet cho bảng trong tab Video Info để có hiệu ứng hover giống với tab Downloaded Videos
   - Thêm phương thức show_full_text_tooltip để hiển thị tooltip khi hover vào các ô trong bảng
   - Cập nhật phương thức apply_theme_colors để áp dụng style đồng nhất giữa hai tab
   - Thêm style cho thanh cuộn trong tab Video Info để đảm bảo trải nghiệm nhất quán
   - Đảm bảo màu sắc hiệu ứng hover phù hợp với theme đang sử dụng (dark/light)